!function(){function e(e,s){if(!(e instanceof s))throw new TypeError("Cannot call a class as a function")}function s(e,s){for(var t=0;t<s.length;t++){var i=s[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function t(e,t,i){return t&&s(e.prototype,t),i&&s(e,i),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{yJ6U:function(s,i,n){"use strict";n.r(i),n.d(i,"ChatModule",(function(){return _}));var o=n("ofXK"),r=n("tyNb"),c=n("XNiG"),a=n("fXoL"),u=n("XhcP"),d=n("VRyK"),l=n("JX91"),b=n("7q3A"),h=n("M0ag"),f=n("Wp6s");function m(e,s){if(1&e){var t=a.Vb();a.Ub(0,"mat-card",1),a.bc("click",(function(){a.zc(t);var e=s.$implicit;return a.fc().selectUser(e)})),a.Ub(1,"div",2),a.Ub(2,"div",3),a.Ub(3,"span"),a.Kc(4),a.Tb(),a.Ub(5,"span"),a.Ub(6,"b"),a.Kc(7),a.Tb(),a.Tb(),a.Tb(),a.Ub(8,"span"),a.Kc(9),a.Tb(),a.Tb(),a.Tb()}if(2&e){var i=s.$implicit,n=a.fc();a.Cb(4),a.Lc(n.other(i).nom),a.Cb(3),a.Mc("(",n.other(i).role,")"),a.Cb(2),a.Lc(n.other(i).email)}}var p,g=((p=function(){function s(t,i){e(this,s),this.uow=t,this.session=i,this.list=[],this.update=new c.a,this.info=new c.a,this.subs=[],this.idSelected=0}return t(s,[{key:"ngOnInit",value:function(){var e=this,s=Object(d.a)(this.update).pipe(Object(l.a)(null)).subscribe((function(s){e.getContacts(e.session.user.id)}));this.subs.push(s)}},{key:"selectUser",value:function(e){var s,t;this.idSelected!==e.id&&(this.idSelected=e.id,+e.idMe==+this.session.user.id?(s=e.me,t=e.otheruser):(s=e.otheruser,t=e.me),this.info.next({idDiscussion:e.id,me:s,otheruser:t}))}},{key:"getContacts",value:function(e){var s=this;this.uow.discussions.getContacts(e).subscribe((function(e){console.log(e),s.list=e}))}},{key:"other",value:function(e){return+e.idMe==+this.session.user.id?e.otheruser:e.me}},{key:"ngOnDestroy",value:function(){this.subs.forEach((function(e){e.unsubscribe()}))}}]),s}()).\u0275fac=function(e){return new(e||p)(a.Ob(b.a),a.Ob(h.a))},p.\u0275cmp=a.Ib({type:p,selectors:[["app-contacts"]],inputs:{info:"info"},decls:2,vars:1,consts:[["class","p-2 m-1","style","cursor: pointer; height: 70px;",3,"click",4,"ngFor","ngForOf"],[1,"p-2","m-1",2,"cursor","pointer","height","70px",3,"click"],[1,"d-flex","flex-column","justify-content-between",2,"height","100%"],[1,"d-flex","justify-content-between"]],template:function(e,s){1&e&&(a.Ub(0,"div"),a.Ic(1,m,10,3,"mat-card",0),a.Tb()),2&e&&(a.Cb(1),a.mc("ngForOf",s.list))},directives:[o.m,f.a],styles:["span[_ngcontent-%COMP%]{font-size:.8em}"]}),p),v=n("3Pt+"),y=n("V2kc"),U=n("OHMa"),w=n("kmnG"),M=n("qFsG"),C=n("bTqV"),k=n("NFeN"),O=["scrollMe"],T=function(e,s){return{ml:e,mr:s}};function x(e,s){if(1&e&&(a.Ub(0,"mat-card",11),a.Ub(1,"p"),a.Kc(2),a.Tb(),a.Ub(3,"div",12),a.Ub(4,"span",13),a.Kc(5),a.gc(6,"date"),a.Tb(),a.Ub(7,"span",13),a.Kc(8),a.Tb(),a.Tb(),a.Tb()),2&e){var t=s.$implicit,i=a.fc(2);a.mc("ngClass",a.pc(7,T,i.isYou(t.idMe),!i.isYou(t.idMe))),a.Cb(2),a.Lc(t.message),a.Cb(3),a.Lc(a.ic(6,4,t.date,"dd/MM/yyyy HH:mm")),a.Cb(3),a.Mc("",i.nameUser(t)," - ")}}function q(e,s){if(1&e){var t=a.Vb();a.Ub(0,"section",1),a.Ub(1,"div",4,5),a.Ic(3,x,9,10,"mat-card",6),a.Tb(),a.Ub(4,"form",7),a.Ub(5,"mat-form-field",8),a.Ub(6,"mat-label"),a.Kc(7,"Message"),a.Tb(),a.Pb(8,"input",9),a.Ub(9,"button",10),a.bc("click",(function(){a.zc(t);var e=a.fc();return e.send(e.myFormMessage.value)})),a.Ub(10,"mat-icon"),a.Kc(11,"send"),a.Tb(),a.Tb(),a.Tb(),a.Tb(),a.Tb()}if(2&e){var i=a.fc();a.Cb(3),a.mc("ngForOf",i.list),a.Cb(1),a.mc("formGroup",i.myFormMessage),a.Cb(5),a.mc("disabled",i.myFormMessage.invalid)}}var F,I,P,j,N=((F=function(){function s(t,i,n,o){e(this,s),this.uow=t,this.session=i,this.chat=n,this.fb=o,this.info=new c.a,this.list=[],this.discussion=new y.f,this.o=new y.i,this.update=new c.a,this.subs=[]}return t(s,[{key:"ngOnInit",value:function(){var e=this;this.createForm(),this.createFormMessage();var s=Object(d.a)(this.info).pipe(Object(l.a)(null)).subscribe((function(s){console.log(s);try{s=s||JSON.parse(atob(localStorage.getItem("selectedUser")))}catch(t){}s&&(localStorage.setItem("selectedUser",btoa(JSON.stringify(s))),e.discussion.id=s.idDiscussion,e.discussion.idMe=s.me.id,e.discussion.idOtherUser=s.otheruser.id,e.discussion.me=s.me,e.discussion.otheruser=s.otheruser,e.getContacts(s.idDiscussion),e.createForm(),e.createFormMessage())}));this.subs.push(s),this.scrollToBottom(),this.chat.newMessage.subscribe((function(s){console.log(s),e.list.push(s)}))}},{key:"ngAfterViewChecked",value:function(){this.scrollToBottom()}},{key:"getContacts",value:function(e){var s=this;this.uow.messages.getMessages(e).subscribe((function(e){console.log(e),s.list=e}))}},{key:"isYou",value:function(e){return+e==+this.session.user.id}},{key:"nameUser",value:function(e){return+e.idMe==+this.session.user.id?"".concat(this.session.user.nom," ").concat(this.session.user.prenom," ").concat(e.idMe," == ").concat(+this.session.user.id):e.otherUserName}},{key:"scrollToBottom",value:function(){try{this.myScrollContainer.nativeElement.scrollTop=this.myScrollContainer.nativeElement.scrollHeight}catch(e){}}},{key:"displayName",value:function(e){return""!==e.userName?e.userName:e.email.substring(0,e.email.indexOf("@"))}},{key:"ngOnDestroy",value:function(){this.subs.forEach((function(e){e.unsubscribe()}))}},{key:"createForm",value:function(){this.myForm=this.fb.group({id:[this.discussion.id,[v.u.required]],unReaded:[this.discussion.unReaded,[v.u.required]],date:[this.discussion.date,[v.u.required]],idMe:[this.discussion.idMe,[v.u.required]],idOtherUser:[this.discussion.idOtherUser,[v.u.required]]})}},{key:"createFormMessage",value:function(){this.myFormMessage=this.fb.group({id:[this.o.id,[v.u.required]],object:[this.o.object,[v.u.required]],message:[this.o.message,[v.u.required]],vu:[this.o.vu,[v.u.required]],date:[this.o.date,[v.u.required]],idCours:[this.o.idCours,[v.u.required]],otherUserName:[this.discussion.me.nom+" "+this.discussion.me.prenom,[v.u.required]],otherUserImage:[this.discussion.me.imageUrl,[v.u.required]],idMe:[this.discussion.idMe,[v.u.required]],idOtherUser:[this.discussion.idOtherUser,[v.u.required]],idDiscussion:[this.discussion.id,[v.u.required]]})}},{key:"send",value:function(e){var s=this;console.log(e),this.uow.messages.postMessage(e).subscribe((function(t){console.log(t),s.list.push(e)}))}}]),s}()).\u0275fac=function(e){return new(e||F)(a.Ob(b.a),a.Ob(h.a),a.Ob(U.a),a.Ob(v.e))},F.\u0275cmp=a.Ib({type:F,selectors:[["app-message"]],viewQuery:function(e,s){var t;1&e&&a.Pc(O,!0),2&e&&a.wc(t=a.cc())&&(s.myScrollContainer=t.first)},inputs:{info:"info"},decls:6,vars:2,consts:[[1,"m-1"],[1,"col-md-12"],[1,"d-flex","justify-content-between"],["class","col-md-12",4,"ngIf"],[1,"chat","mt-2"],["scrollMe",""],["class","mb-2",3,"ngClass",4,"ngFor","ngForOf"],[3,"formGroup"],["appearance","fill",1,"col-md-12"],["matInput","","formControlName","message"],["mat-icon-button","","matSuffix","",3,"disabled","click"],[1,"mb-2",3,"ngClass"],[1,"d-flex","flex-row-reverse","align-items-center","w-100",2,"font-size",".8em","font-style","italic"],[1,"text-muted"]],template:function(e,s){1&e&&(a.Ub(0,"div",0),a.Ub(1,"mat-card",1),a.Ub(2,"div",2),a.Ub(3,"span"),a.Kc(4),a.Tb(),a.Tb(),a.Tb(),a.Tb(),a.Ic(5,q,12,3,"section",3)),2&e&&(a.Cb(4),a.Lc(s.discussion.otheruser.nom),a.Cb(1),a.mc("ngIf",0!==s.discussion.id))},directives:[f.a,o.n,o.m,v.v,v.p,v.i,w.c,w.f,M.b,v.c,v.o,v.h,C.a,w.g,k.a,o.l],pipes:[o.e],styles:[".ml[_ngcontent-%COMP%]{background-color:#dcf8c6;margin-left:50px}.mr[_ngcontent-%COMP%]{background-color:#fff5c4;margin-right:50px;margin-left:8px}.chat[_ngcontent-%COMP%]{scrollbar-color:rgba(0,0,0,.2) hsla(0,0%,100%,.1)!important;scrollbar-width:thin!important;overflow-y:scroll;height:60vh;background-image:repeating-linear-gradient(90deg,hsla(0,0%,77.6%,.05),hsla(0,0%,77.6%,.05) 1px,transparent 0,transparent 5px),repeating-linear-gradient(0deg,hsla(0,0%,77.6%,.05),hsla(0,0%,77.6%,.05) 1px,transparent 0,transparent 5px),repeating-linear-gradient(0deg,hsla(0,0%,77.6%,.06),hsla(0,0%,77.6%,.06) 1px,transparent 0,transparent 15px),repeating-linear-gradient(90deg,hsla(0,0%,77.6%,.06),hsla(0,0%,77.6%,.06) 1px,transparent 0,transparent 15px),linear-gradient(90deg,#fff,#fff)}.chat[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}.chat[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:rgba(0,0,0,.2) hsla(0,0%,100%,.1)!important}.chat[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#bbb}mat-card[_ngcontent-%COMP%]{box-shadow:none!important;padding:5px}"]}),F),K=[{path:"",component:(I=function(){function s(){e(this,s),this.info=new c.a}return t(s,[{key:"ngOnInit",value:function(){}}]),s}(),I.\u0275fac=function(e){return new(e||I)},I.\u0275cmp=a.Ib({type:I,selectors:[["app-chat"]],decls:8,vars:3,consts:[[2,"z-index","9","height","calc(100vh - 200px)"],["sidenav",""],["mode","side",3,"opened"],["snav",""],[2,"width","220px"],[3,"info"]],template:function(e,s){1&e&&(a.Ub(0,"mat-sidenav-container",0,1),a.Ub(2,"mat-sidenav",2,3),a.Ub(4,"div",4),a.Pb(5,"app-contacts",5),a.Tb(),a.Tb(),a.Ub(6,"mat-sidenav-content"),a.Pb(7,"app-message",5),a.Tb(),a.Tb()),2&e&&(a.Cb(2),a.mc("opened",!0),a.Cb(3),a.mc("info",s.info),a.Cb(2),a.mc("info",s.info))},directives:[u.b,u.a,g,u.c,N],styles:[""]}),I)}],S=((P=function s(){e(this,s)}).\u0275mod=a.Mb({type:P}),P.\u0275inj=a.Lb({factory:function(e){return new(e||P)},imports:[[r.h.forChild(K)],r.h]}),P),L=n("MutI"),_=((j=function s(){e(this,s)}).\u0275mod=a.Mb({type:j}),j.\u0275inj=a.Lb({factory:function(e){return new(e||j)},imports:[[o.c,S,u.d,L.b,C.b,f.f,v.j,v.s,w.e,k.b,M.c]]}),j)}}])}();