!function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{yJ6U:function(t,n,s){"use strict";s.r(n),s.d(n,"ChatModule",function(){return H});var o=s("ofXK"),c=s("tyNb"),r=s("XNiG"),a=s("fXoL"),u=s("XhcP"),l=s("mrSG"),d=s("VRyK"),b=s("JX91"),f=s("V2kc"),m=s("7q3A"),h=s("M0ag"),p=s("0EQZ"),g=s("3Pt+"),v=s("eIep"),y=s("kmnG"),w=s("qFsG"),C=s("/1cH"),U=s("bTqV"),k=s("NFeN"),T=s("FKr1");function x(e,t){if(1&e){var i=a.Vb();a.Ub(0,"mat-option",6),a.bc("click",function(){a.zc(i);var e=t.$implicit;return a.fc().selected(e)}),a.Kc(1),a.Tb()}if(2&e){var n=t.$implicit,s=a.fc();a.mc("value",n),a.Cb(1),a.Mc(" ",n[s.field]," ")}}var M,O=((M=function(){function t(){e(this,t),this.selection=new p.c(!0,[]),this.myAuto=new g.f(""),this.selectedChange=new r.a}return i(t,[{key:"ngOnInit",value:function(){this.autoComplete(),this.filteredOptions.subscribe(function(e){console.log(e)})}},{key:"autoComplete",value:function(){var e=this;this.filteredOptions=this.myAuto.valueChanges.pipe(Object(v.a)(function(t){return t.length>1?e.list.autocomplete(e.field,t):[]}))}},{key:"selected0",value:function(e){}},{key:"selected",value:function(e){this.selectedChange.next(e)}},{key:"clear",value:function(){this.myAuto.setValue(""),this.selectedChange.next(null)}}]),t}()).\u0275fac=function(e){return new(e||M)},M.\u0275cmp=a.Ib({type:M,selectors:[["app-auto-complete"]],inputs:{list:"list",field:"field",label:"label"},outputs:{selectedChange:"selectedChange"},decls:11,vars:7,consts:[[1,"",2,"width","100%","padding","0 5px"],["matInput","","placeholder","auto compl\xe9tion",3,"formControl","value","matAutocomplete"],[3,"optionSelected"],["auto","matAutocomplete"],[3,"value","click",4,"ngFor","ngForOf"],["mat-icon-button","","matSuffix","",3,"click"],[3,"value","click"]],template:function(e,t){if(1&e&&(a.Ub(0,"mat-form-field",0),a.Ub(1,"mat-label"),a.Kc(2),a.Tb(),a.Pb(3,"input",1),a.Ub(4,"mat-autocomplete",2,3),a.bc("optionSelected",function(e){return t.selected0(e)}),a.Ic(6,x,2,2,"mat-option",4),a.gc(7,"async"),a.Tb(),a.Ub(8,"button",5),a.bc("click",function(){return t.clear()}),a.Ub(9,"mat-icon"),a.Kc(10,"clear"),a.Tb(),a.Tb(),a.Tb()),2&e){var i=a.xc(5);a.Cb(2),a.Lc(t.label),a.Cb(1),a.mc("formControl",t.myAuto)("value",t.myAuto.value[t.field])("matAutocomplete",i),a.Cb(3),a.mc("ngForOf",a.hc(7,5,t.filteredOptions))}},directives:[y.c,y.f,w.b,g.c,C.c,g.o,g.g,C.a,o.m,U.a,y.g,k.a,T.n],pipes:[o.b],styles:[""]}),M),F=s("Wp6s"),j=s("STbY");function I(e,t){if(1&e){var i=a.Vb();a.Ub(0,"mat-card",2),a.bc("click",function(){a.zc(i);var e=t.$implicit;return a.fc().selectUser(e)}),a.Ub(1,"div",3),a.Ub(2,"div",4),a.Ub(3,"span"),a.Kc(4),a.Tb(),a.Ub(5,"span"),a.Ub(6,"b"),a.Kc(7),a.Tb(),a.Tb(),a.Tb(),a.Ub(8,"div",5),a.Ub(9,"span"),a.Kc(10),a.Tb(),a.Ub(11,"div",6),a.Ub(12,"mat-icon",7),a.Kc(13,"expand_more"),a.Tb(),a.Ub(14,"mat-menu",null,8),a.Ub(16,"button",9),a.bc("click",function(){a.zc(i);var e=t.$implicit;return a.fc().delete(e)}),a.Ub(17,"span"),a.Kc(18,"delete"),a.Tb(),a.Tb(),a.Tb(),a.Tb(),a.Tb(),a.Tb(),a.Tb()}if(2&e){var n=t.$implicit,s=a.xc(15),o=a.fc();a.Cb(4),a.Lc(o.other(n).nom),a.Cb(3),a.Mc("(",o.other(n).role,")"),a.Cb(3),a.Lc(o.other(n).email),a.Cb(2),a.mc("matMenuTriggerFor",s)}}var P,q=((P=function(){function t(i,n){e(this,t),this.uow=i,this.session=n,this.list=[],this.update=new r.a,this.info=new r.a,this.subs=[],this.idSelected=-1}return i(t,[{key:"ngOnInit",value:function(){var e=this,t=Object(d.a)(this.update).pipe(Object(b.a)(null)).subscribe(function(t){e.getContacts(e.session.user.id)});this.subs.push(t)}},{key:"selectedUser",value:function(e){console.log(e);var t=new f.f;t.idMe=this.session.user.id,t.me=this.session.user,t.idOtherUser=e.id,t.otheruser=e,this.list.unshift(t),this.selectUser(t)}},{key:"selectUser",value:function(e){var t,i;this.idSelected!==e.id&&(this.idSelected=e.id,+e.idMe==+this.session.user.id?(t=e.me,i=e.otheruser):(t=e.otheruser,i=e.me),this.info.next({idDiscussion:e.id,me:t,otheruser:i}))}},{key:"getContacts",value:function(e){var t=this;this.uow.discussions.getContacts(e).subscribe(function(e){console.log(e),t.list=e})}},{key:"other",value:function(e){return+e.idMe==+this.session.user.id?e.otheruser:e.me}},{key:"delete",value:function(e){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var i,n=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:i=this.uow.discussions.delete(e.id).subscribe(function(){var t=n.list.findIndex(function(t){return t.id===e.id});t>-1&&n.list.splice(t,1)}),this.subs.push(i);case 2:case"end":return t.stop()}},t,this)}))}},{key:"ngOnDestroy",value:function(){this.subs.forEach(function(e){e.unsubscribe()})}}]),t}()).\u0275fac=function(e){return new(e||P)(a.Ob(m.a),a.Ob(h.a))},P.\u0275cmp=a.Ib({type:P,selectors:[["app-contacts"]],inputs:{info:"info"},decls:3,vars:2,consts:[["label","users","field","nom",3,"list","selectedChange"],["class","p-2 m-1","style","cursor: pointer; height: 70px;",3,"click",4,"ngFor","ngForOf"],[1,"p-2","m-1",2,"cursor","pointer","height","70px",3,"click"],[1,"d-flex","flex-column","justify-content-between",2,"height","100%"],[1,"d-flex","justify-content-between"],[1,"d-flex","justify-content-between","align-items-end"],[2,"height","20px"],[2,"cursor","pointer",3,"matMenuTriggerFor"],["menu","matMenu"],["mat-menu-item","",3,"click"]],template:function(e,t){1&e&&(a.Ub(0,"div"),a.Ub(1,"app-auto-complete",0),a.bc("selectedChange",function(e){return t.selectedUser(e)}),a.Tb(),a.Ic(2,I,19,4,"mat-card",1),a.Tb()),2&e&&(a.Cb(1),a.mc("list",t.uow.users),a.Cb(1),a.mc("ngForOf",t.list))},directives:[O,o.m,F.a,k.a,j.d,j.a,j.b],styles:["span[_ngcontent-%COMP%]{font-size:.8em}"]}),P),K=s("OHMa"),S=["scrollMe"],_=function(e,t){return{ml:e,mr:t}};function A(e,t){if(1&e&&(a.Ub(0,"mat-card",13),a.Ub(1,"p"),a.Kc(2),a.Tb(),a.Ub(3,"div",14),a.Ub(4,"span",15),a.Kc(5),a.gc(6,"date"),a.Tb(),a.Ub(7,"span",15),a.Kc(8),a.Tb(),a.Tb(),a.Tb()),2&e){var i=t.$implicit,n=a.fc(2);a.mc("ngClass",a.pc(7,_,n.isYou(i.idMe),!n.isYou(i.idMe))),a.Cb(2),a.Lc(i.message),a.Cb(3),a.Lc(a.ic(6,4,i.date,"dd/MM/yyyy HH:mm")),a.Cb(3),a.Mc("",n.nameUser(i)," - ")}}function N(e,t){if(1&e&&(a.Ub(0,"section",9),a.Ub(1,"div",10,11),a.Ic(3,A,9,10,"mat-card",12),a.Tb(),a.Tb()),2&e){var i=a.fc();a.Cb(3),a.mc("ngForOf",i.list)}}var L,R,V,z,D=((L=function(){function t(i,n,s,o){e(this,t),this.uow=i,this.session=n,this.chat=s,this.fb=o,this.info=new r.a,this.info2=null,this.list=[],this.discussion=new f.f,this.o=new f.i,this.update=new r.a,this.subs=[]}return i(t,[{key:"ngOnInit",value:function(){var e=this;this.createForm(),this.createFormMessage();var t=Object(d.a)(this.info,this.update).pipe(Object(b.a)(null)).subscribe(function(t){console.log(t),e.info2=t,t&&(e.discussion.id=t.idDiscussion,e.discussion.idMe=t.me.id,e.discussion.idOtherUser=t.otheruser.id,e.discussion.me=t.me,e.discussion.otheruser=t.otheruser,e.getContacts(e.discussion.id),e.createForm(),e.createFormMessage())});this.subs.push(t),this.scrollToBottom(),this.chat.newMessage.subscribe(function(t){console.log(t),e.list.push(t)})}},{key:"ngAfterViewChecked",value:function(){this.scrollToBottom()}},{key:"getContacts",value:function(e){var t=this;this.uow.messages.getMessages(e).subscribe(function(e){console.log(e),t.list=e})}},{key:"isYou",value:function(e){return+e==+this.session.user.id}},{key:"nameUser",value:function(e){return+e.idMe==+this.session.user.id?"".concat(this.session.user.nom," ").concat(this.session.user.prenom):e.otherUserName}},{key:"scrollToBottom",value:function(){try{this.myScrollContainer.nativeElement.scrollTop=this.myScrollContainer.nativeElement.scrollHeight}catch(e){}}},{key:"displayName",value:function(e){return""!==e.userName?e.userName:e.email.substring(0,e.email.indexOf("@"))}},{key:"ngOnDestroy",value:function(){this.subs.forEach(function(e){e.unsubscribe()})}},{key:"createForm",value:function(){this.myForm=this.fb.group({id:[this.discussion.id,[g.u.required]],unReaded:[this.discussion.unReaded,[g.u.required]],date:[this.discussion.date,[g.u.required]],idMe:[this.discussion.idMe,[g.u.required]],idOtherUser:[this.discussion.idOtherUser,[g.u.required]]})}},{key:"createFormMessage",value:function(){this.myFormMessage=this.fb.group({id:[this.o.id,[g.u.required]],object:[this.o.object,[g.u.required]],message:[this.o.message,[g.u.required]],vu:[this.o.vu,[g.u.required]],date:[this.o.date,[g.u.required]],idCours:[this.o.idCours,[g.u.required]],otherUserName:[this.discussion.me.nom+" "+this.discussion.me.prenom,[g.u.required]],otherUserImage:[this.discussion.me.imageUrl,[g.u.required]],idMe:[this.discussion.idMe,[g.u.required]],idOtherUser:[this.discussion.idOtherUser,[g.u.required]],idDiscussion:[this.discussion.id,[g.u.required]]})}},{key:"send",value:function(e){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var i,n,s=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log(this.discussion,e),0!==this.discussion.id){t.next=7;break}return delete(i=Object.assign(new f.f,this.discussion)).messages,delete i.me,delete i.otheruser,t.next=5,this.uow.discussions.post(i).toPromise();case 5:n=t.sent,e.idDiscussion=n.id;case 7:this.uow.messages.postMessage(e).subscribe(function(e){console.log(e),s.list.push(e)});case 8:case"end":return t.stop()}},t,this)}))}}]),t}()).\u0275fac=function(e){return new(e||L)(a.Ob(m.a),a.Ob(h.a),a.Ob(K.a),a.Ob(g.e))},L.\u0275cmp=a.Ib({type:L,selectors:[["app-message"]],viewQuery:function(e,t){var i;1&e&&a.Pc(S,!0),2&e&&a.wc(i=a.cc())&&(t.myScrollContainer=i.first)},inputs:{info:"info"},decls:17,vars:4,consts:[[1,"parent","mx-2"],[1,"mx-1"],[1,"d-flex","justify-content-between"],[2,"cursor","pointer",3,"click"],["class","d-flex justify-ceontent-between flex-column","style","height: 100%;",4,"ngIf"],[3,"formGroup"],["appearance","fill",2,"width","100%"],["matInput","","formControlName","message"],["mat-icon-button","","matSuffix","",3,"disabled","click"],[1,"d-flex","justify-ceontent-between","flex-column",2,"height","100%"],[1,"chat","mt-2",2,"margin-bottom","140px"],["scrollMe",""],["class","mb-2",3,"ngClass",4,"ngFor","ngForOf"],[1,"mb-2",3,"ngClass"],[1,"d-flex","flex-row-reverse","align-items-center","w-100",2,"font-size",".8em","font-style","italic"],[1,"text-muted"]],template:function(e,t){1&e&&(a.Ub(0,"div",0),a.Ub(1,"mat-card",1),a.Ub(2,"div",2),a.Ub(3,"span"),a.Kc(4),a.Tb(),a.Ub(5,"mat-icon",3),a.bc("click",function(){return t.update.next(t.info2)}),a.Kc(6,"refresh"),a.Tb(),a.Tb(),a.Tb(),a.Ic(7,N,4,1,"section",4),a.Ub(8,"form",5),a.Ub(9,"mat-card",1),a.Ub(10,"mat-form-field",6),a.Ub(11,"mat-label"),a.Kc(12,"Message"),a.Tb(),a.Pb(13,"input",7),a.Ub(14,"button",8),a.bc("click",function(){return t.send(t.myFormMessage.value)}),a.Ub(15,"mat-icon"),a.Kc(16,"send"),a.Tb(),a.Tb(),a.Tb(),a.Tb(),a.Tb(),a.Tb()),2&e&&(a.Cb(4),a.Lc(t.discussion.otheruser.nom),a.Cb(3),a.mc("ngIf",0!==t.discussion.id),a.Cb(1),a.mc("formGroup",t.myFormMessage),a.Cb(6),a.mc("disabled",t.myFormMessage.invalid))},directives:[F.a,k.a,o.n,g.v,g.p,g.i,y.c,y.f,w.b,g.c,g.o,g.h,U.a,y.g,o.m,o.l],pipes:[o.e],styles:[".ml[_ngcontent-%COMP%]{background-color:#dcf8c6;margin-left:50px}.mr[_ngcontent-%COMP%]{background-color:#fff5c4;margin-right:50px;margin-left:8px}.parent[_ngcontent-%COMP%]{position:relative;height:100%;overflow-y:hidden}.parent[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{position:absolute;bottom:5px;width:100%}.chat[_ngcontent-%COMP%]{scrollbar-color:rgba(0,0,0,.2) hsla(0,0%,100%,.1)!important;scrollbar-width:thin!important;overflow-y:scroll;height:100%;background-image:repeating-linear-gradient(90deg,hsla(0,0%,77.6%,.05),hsla(0,0%,77.6%,.05) 1px,transparent 0,transparent 5px),repeating-linear-gradient(0deg,hsla(0,0%,77.6%,.05),hsla(0,0%,77.6%,.05) 1px,transparent 0,transparent 5px),repeating-linear-gradient(0deg,hsla(0,0%,77.6%,.06),hsla(0,0%,77.6%,.06) 1px,transparent 0,transparent 15px),repeating-linear-gradient(90deg,hsla(0,0%,77.6%,.06),hsla(0,0%,77.6%,.06) 1px,transparent 0,transparent 15px),linear-gradient(90deg,#fff,#fff)}.chat[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}.chat[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:rgba(0,0,0,.2) hsla(0,0%,100%,.1)!important}.chat[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#bbb}mat-card[_ngcontent-%COMP%]{padding:5px}"]}),L),E=[{path:"",component:(R=function(){function t(){e(this,t),this.info=new r.a}return i(t,[{key:"ngOnInit",value:function(){}}]),t}(),R.\u0275fac=function(e){return new(e||R)},R.\u0275cmp=a.Ib({type:R,selectors:[["app-chat"]],decls:8,vars:3,consts:[[2,"z-index","9","height","calc(100vh - 200px)"],["sidenav",""],["mode","side",3,"opened"],["snav",""],[2,"width","220px"],[3,"info"]],template:function(e,t){1&e&&(a.Ub(0,"mat-sidenav-container",0,1),a.Ub(2,"mat-sidenav",2,3),a.Ub(4,"div",4),a.Pb(5,"app-contacts",5),a.Tb(),a.Tb(),a.Ub(6,"mat-sidenav-content"),a.Pb(7,"app-message",5),a.Tb(),a.Tb()),2&e&&(a.Cb(2),a.mc("opened",!0),a.Cb(3),a.mc("info",t.info),a.Cb(2),a.mc("info",t.info))},directives:[u.b,u.a,q,u.c,D],styles:[""]}),R)}],G=((V=function t(){e(this,t)}).\u0275mod=a.Mb({type:V}),V.\u0275inj=a.Lb({factory:function(e){return new(e||V)},imports:[[c.h.forChild(E)],c.h]}),V),$=s("MutI"),H=((z=function t(){e(this,t)}).\u0275mod=a.Mb({type:z}),z.\u0275inj=a.Lb({factory:function(e){return new(e||z)},imports:[[o.c,G,u.d,$.b,U.b,F.f,g.j,g.s,y.e,k.b,w.c,C.b,j.c]]}),z)}}])}();