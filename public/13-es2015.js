(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{yJ6U:function(s,e,t){"use strict";t.r(e),t.d(e,"ChatModule",(function(){return I}));var i=t("ofXK"),n=t("tyNb"),r=t("XNiG"),o=t("fXoL"),c=t("XhcP"),a=t("VRyK"),u=t("JX91"),d=t("7q3A"),b=t("M0ag"),l=t("Wp6s");function h(s,e){if(1&s){const s=o.Vb();o.Ub(0,"mat-card",1),o.bc("click",(function(){o.zc(s);const t=e.$implicit;return o.fc().selectUser(t)})),o.Ub(1,"div",2),o.Ub(2,"div",3),o.Ub(3,"span"),o.Kc(4),o.Tb(),o.Ub(5,"span"),o.Ub(6,"b"),o.Kc(7),o.Tb(),o.Tb(),o.Tb(),o.Ub(8,"span"),o.Kc(9),o.Tb(),o.Tb(),o.Tb()}if(2&s){const s=e.$implicit,t=o.fc();o.Cb(4),o.Lc(t.other(s).nom),o.Cb(3),o.Mc("(",t.other(s).role,")"),o.Cb(2),o.Lc(t.other(s).email)}}let m=(()=>{class s{constructor(s,e){this.uow=s,this.session=e,this.list=[],this.update=new r.a,this.info=new r.a,this.subs=[],this.idSelected=0}ngOnInit(){const s=Object(a.a)(this.update).pipe(Object(u.a)(null)).subscribe(s=>{this.getContacts(this.session.user.id)});this.subs.push(s)}selectUser(s){if(this.idSelected===s.id)return;let e,t;this.idSelected=s.id,+s.idMe==+this.session.user.id?(e=s.me,t=s.otheruser):(e=s.otheruser,t=s.me),this.info.next({idDiscussion:s.id,me:e,otheruser:t})}getContacts(s){this.uow.discussions.getContacts(s).subscribe(s=>{console.log(s),this.list=s})}other(s){return+s.idMe==+this.session.user.id?s.otheruser:s.me}ngOnDestroy(){this.subs.forEach(s=>{s.unsubscribe()})}}return s.\u0275fac=function(e){return new(e||s)(o.Ob(d.a),o.Ob(b.a))},s.\u0275cmp=o.Ib({type:s,selectors:[["app-contacts"]],inputs:{info:"info"},decls:2,vars:1,consts:[["class","p-2 m-1","style","cursor: pointer; height: 70px;",3,"click",4,"ngFor","ngForOf"],[1,"p-2","m-1",2,"cursor","pointer","height","70px",3,"click"],[1,"d-flex","flex-column","justify-content-between",2,"height","100%"],[1,"d-flex","justify-content-between"]],template:function(s,e){1&s&&(o.Ub(0,"div"),o.Ic(1,h,10,3,"mat-card",0),o.Tb()),2&s&&(o.Cb(1),o.mc("ngForOf",e.list))},directives:[i.m,l.a],styles:["span[_ngcontent-%COMP%]{font-size:.8em}"]}),s})();var p=t("3Pt+"),f=t("V2kc"),g=t("OHMa"),U=t("kmnG"),M=t("qFsG"),w=t("bTqV"),C=t("NFeN");const y=["scrollMe"],O=function(s,e){return{ml:s,mr:e}};function v(s,e){if(1&s&&(o.Ub(0,"mat-card",11),o.Ub(1,"p"),o.Kc(2),o.Tb(),o.Ub(3,"div",12),o.Ub(4,"span",13),o.Kc(5),o.gc(6,"date"),o.Tb(),o.Ub(7,"span",13),o.Kc(8),o.Tb(),o.Tb(),o.Tb()),2&s){const s=e.$implicit,t=o.fc(2);o.mc("ngClass",o.pc(7,O,t.isYou(s.idMe),!t.isYou(s.idMe))),o.Cb(2),o.Lc(s.message),o.Cb(3),o.Lc(o.ic(6,4,s.date,"dd/MM/yyyy HH:mm")),o.Cb(3),o.Mc("",t.nameUser(s)," - ")}}function T(s,e){if(1&s){const s=o.Vb();o.Ub(0,"section",1),o.Ub(1,"div",4,5),o.Ic(3,v,9,10,"mat-card",6),o.Tb(),o.Ub(4,"form",7),o.Ub(5,"mat-form-field",8),o.Ub(6,"mat-label"),o.Kc(7,"Message"),o.Tb(),o.Pb(8,"input",9),o.Ub(9,"button",10),o.bc("click",(function(){o.zc(s);const e=o.fc();return e.send(e.myFormMessage.value)})),o.Ub(10,"mat-icon"),o.Kc(11,"send"),o.Tb(),o.Tb(),o.Tb(),o.Tb(),o.Tb()}if(2&s){const s=o.fc();o.Cb(3),o.mc("ngForOf",s.list),o.Cb(1),o.mc("formGroup",s.myFormMessage),o.Cb(5),o.mc("disabled",s.myFormMessage.invalid)}}let x=(()=>{class s{constructor(s,e,t,i){this.uow=s,this.session=e,this.chat=t,this.fb=i,this.info=new r.a,this.list=[],this.discussion=new f.f,this.o=new f.i,this.update=new r.a,this.subs=[]}ngOnInit(){this.createForm(),this.createFormMessage();const s=Object(a.a)(this.info).pipe(Object(u.a)(null)).subscribe(s=>{console.log(s);try{s=s||JSON.parse(atob(localStorage.getItem("selectedUser")))}catch(e){}s&&(localStorage.setItem("selectedUser",btoa(JSON.stringify(s))),this.discussion.id=s.idDiscussion,this.discussion.idMe=s.me.id,this.discussion.idOtherUser=s.otheruser.id,this.discussion.me=s.me,this.discussion.otheruser=s.otheruser,this.getContacts(s.idDiscussion),this.createForm(),this.createFormMessage())});this.subs.push(s),this.scrollToBottom(),this.chat.newMessage.subscribe(s=>{console.log(s),this.list.push(s)})}ngAfterViewChecked(){this.scrollToBottom()}getContacts(s){this.uow.messages.getMessages(s).subscribe(s=>{console.log(s),this.list=s})}isYou(s){return+s==+this.session.user.id}nameUser(s){return+s.idMe==+this.session.user.id?`${this.session.user.nom} ${this.session.user.prenom}`:s.otherUserName}scrollToBottom(){try{this.myScrollContainer.nativeElement.scrollTop=this.myScrollContainer.nativeElement.scrollHeight}catch(s){}}displayName(s){return""!==s.userName?s.userName:s.email.substring(0,s.email.indexOf("@"))}ngOnDestroy(){this.subs.forEach(s=>{s.unsubscribe()})}createForm(){this.myForm=this.fb.group({id:[this.discussion.id,[p.u.required]],unReaded:[this.discussion.unReaded,[p.u.required]],date:[this.discussion.date,[p.u.required]],idMe:[this.discussion.idMe,[p.u.required]],idOtherUser:[this.discussion.idOtherUser,[p.u.required]]})}createFormMessage(){this.myFormMessage=this.fb.group({id:[this.o.id,[p.u.required]],object:[this.o.object,[p.u.required]],message:[this.o.message,[p.u.required]],vu:[this.o.vu,[p.u.required]],date:[this.o.date,[p.u.required]],idCours:[this.o.idCours,[p.u.required]],otherUserName:[this.discussion.me.nom+" "+this.discussion.me.prenom,[p.u.required]],otherUserImage:[this.discussion.me.imageUrl,[p.u.required]],idMe:[this.discussion.idMe,[p.u.required]],idOtherUser:[this.discussion.idOtherUser,[p.u.required]],idDiscussion:[this.discussion.id,[p.u.required]]})}send(s){console.log(s),this.uow.messages.postMessage(s).subscribe(e=>{console.log(e),this.list.push(s)})}}return s.\u0275fac=function(e){return new(e||s)(o.Ob(d.a),o.Ob(b.a),o.Ob(g.a),o.Ob(p.e))},s.\u0275cmp=o.Ib({type:s,selectors:[["app-message"]],viewQuery:function(s,e){var t;1&s&&o.Pc(y,!0),2&s&&o.wc(t=o.cc())&&(e.myScrollContainer=t.first)},inputs:{info:"info"},decls:6,vars:2,consts:[[1,"m-1"],[1,"col-md-12"],[1,"d-flex","justify-content-between"],["class","col-md-12",4,"ngIf"],[1,"chat","mt-2"],["scrollMe",""],["class","mb-2",3,"ngClass",4,"ngFor","ngForOf"],[3,"formGroup"],["appearance","fill",1,"col-md-12"],["matInput","","formControlName","message"],["mat-icon-button","","matSuffix","",3,"disabled","click"],[1,"mb-2",3,"ngClass"],[1,"d-flex","flex-row-reverse","align-items-center","w-100",2,"font-size",".8em","font-style","italic"],[1,"text-muted"]],template:function(s,e){1&s&&(o.Ub(0,"div",0),o.Ub(1,"mat-card",1),o.Ub(2,"div",2),o.Ub(3,"span"),o.Kc(4),o.Tb(),o.Tb(),o.Tb(),o.Tb(),o.Ic(5,T,12,3,"section",3)),2&s&&(o.Cb(4),o.Lc(e.discussion.otheruser.nom),o.Cb(1),o.mc("ngIf",0!==e.discussion.id))},directives:[l.a,i.n,i.m,p.v,p.p,p.i,U.c,U.f,M.b,p.c,p.o,p.h,w.a,U.g,C.a,i.l],pipes:[i.e],styles:[".ml[_ngcontent-%COMP%]{background-color:#dcf8c6;margin-left:50px}.mr[_ngcontent-%COMP%]{background-color:#fff5c4;margin-right:50px;margin-left:8px}.chat[_ngcontent-%COMP%]{scrollbar-color:rgba(0,0,0,.2) hsla(0,0%,100%,.1)!important;scrollbar-width:thin!important;overflow-y:scroll;height:60vh;background-image:repeating-linear-gradient(90deg,hsla(0,0%,77.6%,.05),hsla(0,0%,77.6%,.05) 1px,transparent 0,transparent 5px),repeating-linear-gradient(0deg,hsla(0,0%,77.6%,.05),hsla(0,0%,77.6%,.05) 1px,transparent 0,transparent 5px),repeating-linear-gradient(0deg,hsla(0,0%,77.6%,.06),hsla(0,0%,77.6%,.06) 1px,transparent 0,transparent 15px),repeating-linear-gradient(90deg,hsla(0,0%,77.6%,.06),hsla(0,0%,77.6%,.06) 1px,transparent 0,transparent 15px),linear-gradient(90deg,#fff,#fff)}.chat[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}.chat[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:rgba(0,0,0,.2) hsla(0,0%,100%,.1)!important}.chat[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#bbb}mat-card[_ngcontent-%COMP%]{box-shadow:none!important;padding:5px}"]}),s})();const k=[{path:"",component:(()=>{class s{constructor(){this.info=new r.a}ngOnInit(){}}return s.\u0275fac=function(e){return new(e||s)},s.\u0275cmp=o.Ib({type:s,selectors:[["app-chat"]],decls:8,vars:3,consts:[[2,"z-index","9","height","calc(100vh - 200px)"],["sidenav",""],["mode","side",3,"opened"],["snav",""],[2,"width","220px"],[3,"info"]],template:function(s,e){1&s&&(o.Ub(0,"mat-sidenav-container",0,1),o.Ub(2,"mat-sidenav",2,3),o.Ub(4,"div",4),o.Pb(5,"app-contacts",5),o.Tb(),o.Tb(),o.Ub(6,"mat-sidenav-content"),o.Pb(7,"app-message",5),o.Tb(),o.Tb()),2&s&&(o.Cb(2),o.mc("opened",!0),o.Cb(3),o.mc("info",e.info),o.Cb(2),o.mc("info",e.info))},directives:[c.b,c.a,m,c.c,x],styles:[""]}),s})()}];let q=(()=>{class s{}return s.\u0275mod=o.Mb({type:s}),s.\u0275inj=o.Lb({factory:function(e){return new(e||s)},imports:[[n.h.forChild(k)],n.h]}),s})();var F=t("MutI");let I=(()=>{class s{}return s.\u0275mod=o.Mb({type:s}),s.\u0275inj=o.Lb({factory:function(e){return new(e||s)},imports:[[i.c,q,c.d,F.b,w.b,l.f,p.j,p.s,U.e,C.b,M.c]]}),s})()}}]);