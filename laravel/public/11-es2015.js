(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{yJ6U:function(e,t,s){"use strict";s.r(t),s.d(t,"ChatModule",function(){return K});var i=s("ofXK"),n=s("tyNb"),o=s("XNiG"),c=s("fXoL"),r=s("XhcP"),a=s("mrSG"),u=s("VRyK"),l=s("JX91"),d=s("V2kc"),b=s("7q3A"),h=s("M0ag"),m=s("0EQZ"),p=s("3Pt+"),f=s("eIep"),g=s("kmnG"),C=s("qFsG"),M=s("/1cH"),U=s("bTqV"),w=s("NFeN"),y=s("FKr1");function v(e,t){if(1&e){const e=c.Vb();c.Ub(0,"mat-option",6),c.bc("click",function(){c.Bc(e);const s=t.$implicit;return c.fc().selected(s)}),c.Mc(1),c.Tb()}if(2&e){const e=t.$implicit,s=c.fc();c.mc("value",e),c.Cb(1),c.Oc(" ",e[s.field]," ")}}let O=(()=>{class e{constructor(){this.selection=new m.c(!0,[]),this.myAuto=new p.f(""),this.selectedChange=new o.a}ngOnInit(){this.autoComplete(),this.filteredOptions.subscribe(e=>{console.log(e)})}autoComplete(){this.filteredOptions=this.myAuto.valueChanges.pipe(Object(f.a)(e=>e.length>1?this.list.autocomplete(this.field,e):[]))}selected0(e){}selected(e){this.selectedChange.next(e)}clear(){this.myAuto.setValue(""),this.selectedChange.next(null)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=c.Ib({type:e,selectors:[["app-auto-complete"]],inputs:{list:"list",field:"field",label:"label"},outputs:{selectedChange:"selectedChange"},decls:11,vars:7,consts:[[1,"",2,"width","100%","padding","0 5px"],["matInput","","placeholder","auto compl\xe9tion",3,"formControl","value","matAutocomplete"],[3,"optionSelected"],["auto","matAutocomplete"],[3,"value","click",4,"ngFor","ngForOf"],["mat-icon-button","","matSuffix","",3,"click"],[3,"value","click"]],template:function(e,t){if(1&e&&(c.Ub(0,"mat-form-field",0),c.Ub(1,"mat-label"),c.Mc(2),c.Tb(),c.Pb(3,"input",1),c.Ub(4,"mat-autocomplete",2,3),c.bc("optionSelected",function(e){return t.selected0(e)}),c.Kc(6,v,2,2,"mat-option",4),c.gc(7,"async"),c.Tb(),c.Ub(8,"button",5),c.bc("click",function(){return t.clear()}),c.Ub(9,"mat-icon"),c.Mc(10,"clear"),c.Tb(),c.Tb(),c.Tb()),2&e){const e=c.yc(5);c.Cb(2),c.Nc(t.label),c.Cb(1),c.mc("formControl",t.myAuto)("value",t.myAuto.value[t.field])("matAutocomplete",e),c.Cb(3),c.mc("ngForOf",c.hc(7,5,t.filteredOptions))}},directives:[g.c,g.f,C.b,p.c,M.c,p.o,p.g,M.a,i.m,U.a,g.g,w.a,y.n],pipes:[i.b],styles:[""]}),e})();var T=s("Wp6s"),x=s("STbY");function k(e,t){if(1&e){const e=c.Vb();c.Ub(0,"mat-card",2),c.bc("click",function(){c.Bc(e);const s=t.$implicit;return c.fc().selectUser(s)}),c.Ub(1,"div",3),c.Ub(2,"div",4),c.Ub(3,"span"),c.Mc(4),c.Tb(),c.Ub(5,"span"),c.Ub(6,"b"),c.Mc(7),c.Tb(),c.Tb(),c.Tb(),c.Ub(8,"div",5),c.Ub(9,"span"),c.Mc(10),c.Tb(),c.Ub(11,"div",6),c.Ub(12,"mat-icon",7),c.Mc(13,"expand_more"),c.Tb(),c.Ub(14,"mat-menu",null,8),c.Ub(16,"button",9),c.bc("click",function(){c.Bc(e);const s=t.$implicit;return c.fc().delete(s)}),c.Ub(17,"span"),c.Mc(18,"delete"),c.Tb(),c.Tb(),c.Tb(),c.Tb(),c.Tb(),c.Tb(),c.Tb()}if(2&e){const e=t.$implicit,s=c.yc(15),i=c.fc();c.Cb(4),c.Nc(i.other(e).nom),c.Cb(3),c.Oc("(",i.other(e).role,")"),c.Cb(3),c.Nc(i.other(e).email),c.Cb(2),c.mc("matMenuTriggerFor",s)}}let F=(()=>{class e{constructor(e,t){this.uow=e,this.session=t,this.list=[],this.update=new o.a,this.info=new o.a,this.subs=[],this.idSelected=-1}ngOnInit(){const e=Object(u.a)(this.update).pipe(Object(l.a)(null)).subscribe(e=>{this.getContacts(this.session.user.id)});this.subs.push(e)}selectedUser(e){console.log(e);const t=new d.f;t.idMe=this.session.user.id,t.me=this.session.user,t.idOtherUser=e.id,t.otheruser=e,this.list.unshift(t),this.selectUser(t)}selectUser(e){if(this.idSelected===e.id)return;let t,s;this.idSelected=e.id,+e.idMe==+this.session.user.id?(t=e.me,s=e.otheruser):(t=e.otheruser,s=e.me),this.info.next({idDiscussion:e.id,me:t,otheruser:s})}getContacts(e){this.uow.discussions.getContacts(e).subscribe(e=>{console.log(e),this.list=e})}other(e){return+e.idMe==+this.session.user.id?e.otheruser:e.me}delete(e){return Object(a.a)(this,void 0,void 0,function*(){const t=this.uow.discussions.delete(e.id).subscribe(()=>{const t=this.list.findIndex(t=>t.id===e.id);t>-1&&this.list.splice(t,1)});this.subs.push(t)})}ngOnDestroy(){this.subs.forEach(e=>{e.unsubscribe()})}}return e.\u0275fac=function(t){return new(t||e)(c.Ob(b.a),c.Ob(h.a))},e.\u0275cmp=c.Ib({type:e,selectors:[["app-contacts"]],inputs:{info:"info"},decls:3,vars:2,consts:[["label","users","field","nom",3,"list","selectedChange"],["class","p-2 m-1","style","cursor: pointer; height: 70px;",3,"click",4,"ngFor","ngForOf"],[1,"p-2","m-1",2,"cursor","pointer","height","70px",3,"click"],[1,"d-flex","flex-column","justify-content-between",2,"height","100%"],[1,"d-flex","justify-content-between"],[1,"d-flex","justify-content-between","align-items-end"],[2,"height","20px"],[2,"cursor","pointer",3,"matMenuTriggerFor"],["menu","matMenu"],["mat-menu-item","",3,"click"]],template:function(e,t){1&e&&(c.Ub(0,"div"),c.Ub(1,"app-auto-complete",0),c.bc("selectedChange",function(e){return t.selectedUser(e)}),c.Tb(),c.Kc(2,k,19,4,"mat-card",1),c.Tb()),2&e&&(c.Cb(1),c.mc("list",t.uow.users),c.Cb(1),c.mc("ngForOf",t.list))},directives:[O,i.m,T.a,w.a,x.d,x.a,x.b],styles:["span[_ngcontent-%COMP%]{font-size:.8em}"]}),e})();var q=s("OHMa");const j=["scrollMe"],P=function(e,t){return{ml:e,mr:t}};function I(e,t){if(1&e&&(c.Ub(0,"mat-card",13),c.Ub(1,"p"),c.Mc(2),c.Tb(),c.Ub(3,"div",14),c.Ub(4,"span",15),c.Mc(5),c.gc(6,"date"),c.Tb(),c.Ub(7,"span",15),c.Mc(8),c.Tb(),c.Tb(),c.Tb()),2&e){const e=t.$implicit,s=c.fc(2);c.mc("ngClass",c.qc(7,P,s.isYou(e.idMe),!s.isYou(e.idMe))),c.Cb(2),c.Nc(e.message),c.Cb(3),c.Nc(c.ic(6,4,e.date,"dd/MM/yyyy HH:mm")),c.Cb(3),c.Oc("",s.nameUser(e)," - ")}}function N(e,t){if(1&e&&(c.Ub(0,"section",9),c.Ub(1,"div",10,11),c.Kc(3,I,9,10,"mat-card",12),c.Tb(),c.Tb()),2&e){const e=c.fc();c.Cb(3),c.mc("ngForOf",e.list)}}let S=(()=>{class e{constructor(e,t,s,i){this.uow=e,this.session=t,this.chat=s,this.fb=i,this.info=new o.a,this.info2=null,this.list=[],this.discussion=new d.f,this.o=new d.i,this.update=new o.a,this.subs=[]}ngOnInit(){this.createForm(),this.createFormMessage();const e=Object(u.a)(this.info,this.update).pipe(Object(l.a)(null)).subscribe(e=>{console.log(e),this.info2=e,e&&(this.discussion.id=e.idDiscussion,this.discussion.idMe=e.me.id,this.discussion.idOtherUser=e.otheruser.id,this.discussion.me=e.me,this.discussion.otheruser=e.otheruser,this.getContacts(this.discussion.id),this.createForm(),this.createFormMessage())});this.subs.push(e),this.scrollToBottom(),this.chat.newMessage.subscribe(e=>{console.log(e),this.list.push(e)})}ngAfterViewChecked(){this.scrollToBottom()}getContacts(e){this.uow.messages.getMessages(e).subscribe(e=>{console.log(e),this.list=e})}isYou(e){return+e==+this.session.user.id}nameUser(e){return+e.idMe==+this.session.user.id?`${this.session.user.nom} ${this.session.user.prenom}`:e.otherUserName}scrollToBottom(){try{this.myScrollContainer.nativeElement.scrollTop=this.myScrollContainer.nativeElement.scrollHeight}catch(e){}}displayName(e){return""!==e.userName?e.userName:e.email.substring(0,e.email.indexOf("@"))}ngOnDestroy(){this.subs.forEach(e=>{e.unsubscribe()})}createForm(){this.myForm=this.fb.group({id:[this.discussion.id,[p.u.required]],unReaded:[this.discussion.unReaded,[p.u.required]],date:[this.discussion.date,[p.u.required]],idMe:[this.discussion.idMe,[p.u.required]],idOtherUser:[this.discussion.idOtherUser,[p.u.required]]})}createFormMessage(){this.myFormMessage=this.fb.group({id:[this.o.id,[p.u.required]],object:[this.o.object,[p.u.required]],message:[this.o.message,[p.u.required]],vu:[this.o.vu,[p.u.required]],date:[this.o.date,[p.u.required]],idCours:[this.o.idCours,[p.u.required]],otherUserName:[this.discussion.me.nom+" "+this.discussion.me.prenom,[p.u.required]],otherUserImage:[this.discussion.me.imageUrl,[p.u.required]],idMe:[this.discussion.idMe,[p.u.required]],idOtherUser:[this.discussion.idOtherUser,[p.u.required]],idDiscussion:[this.discussion.id,[p.u.required]]})}send(e){return Object(a.a)(this,void 0,void 0,function*(){if(console.log(this.discussion,e),0===this.discussion.id){const t=Object.assign(new d.f,this.discussion);delete t.messages,delete t.me,delete t.otheruser;const s=yield this.uow.discussions.post(t).toPromise();e.idDiscussion=s.id}this.uow.messages.postMessage(e).subscribe(e=>{console.log(e),this.list.push(e)})})}}return e.\u0275fac=function(t){return new(t||e)(c.Ob(b.a),c.Ob(h.a),c.Ob(q.a),c.Ob(p.e))},e.\u0275cmp=c.Ib({type:e,selectors:[["app-message"]],viewQuery:function(e,t){if(1&e&&c.Sc(j,!0),2&e){let e;c.xc(e=c.cc())&&(t.myScrollContainer=e.first)}},inputs:{info:"info"},decls:17,vars:4,consts:[[1,"parent","mx-2"],[1,"mx-1"],[1,"d-flex","justify-content-between"],[2,"cursor","pointer",3,"click"],["class","d-flex justify-ceontent-between flex-column","style","height: 100%;",4,"ngIf"],[3,"formGroup"],["appearance","fill",2,"width","100%"],["matInput","","formControlName","message"],["mat-icon-button","","matSuffix","",3,"disabled","click"],[1,"d-flex","justify-ceontent-between","flex-column",2,"height","100%"],[1,"chat","mt-2",2,"margin-bottom","140px"],["scrollMe",""],["class","mb-2",3,"ngClass",4,"ngFor","ngForOf"],[1,"mb-2",3,"ngClass"],[1,"d-flex","flex-row-reverse","align-items-center","w-100",2,"font-size",".8em","font-style","italic"],[1,"text-muted"]],template:function(e,t){1&e&&(c.Ub(0,"div",0),c.Ub(1,"mat-card",1),c.Ub(2,"div",2),c.Ub(3,"span"),c.Mc(4),c.Tb(),c.Ub(5,"mat-icon",3),c.bc("click",function(){return t.update.next(t.info2)}),c.Mc(6,"refresh"),c.Tb(),c.Tb(),c.Tb(),c.Kc(7,N,4,1,"section",4),c.Ub(8,"form",5),c.Ub(9,"mat-card",1),c.Ub(10,"mat-form-field",6),c.Ub(11,"mat-label"),c.Mc(12,"Message"),c.Tb(),c.Pb(13,"input",7),c.Ub(14,"button",8),c.bc("click",function(){return t.send(t.myFormMessage.value)}),c.Ub(15,"mat-icon"),c.Mc(16,"send"),c.Tb(),c.Tb(),c.Tb(),c.Tb(),c.Tb(),c.Tb()),2&e&&(c.Cb(4),c.Nc(t.discussion.otheruser.nom),c.Cb(3),c.mc("ngIf",0!==t.discussion.id),c.Cb(1),c.mc("formGroup",t.myFormMessage),c.Cb(6),c.mc("disabled",t.myFormMessage.invalid))},directives:[T.a,w.a,i.n,p.v,p.p,p.i,g.c,g.f,C.b,p.c,p.o,p.h,U.a,g.g,i.m,i.l],pipes:[i.e],styles:[".ml[_ngcontent-%COMP%]{background-color:#dcf8c6;margin-left:50px}.mr[_ngcontent-%COMP%]{background-color:#fff5c4;margin-right:50px;margin-left:8px}.parent[_ngcontent-%COMP%]{position:relative;height:100%;overflow-y:hidden}.parent[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{position:absolute;bottom:5px;width:100%}.chat[_ngcontent-%COMP%]{scrollbar-color:rgba(0,0,0,.2) hsla(0,0%,100%,.1)!important;scrollbar-width:thin!important;overflow-y:scroll;height:100%;background-image:repeating-linear-gradient(90deg,hsla(0,0%,77.6%,.05),hsla(0,0%,77.6%,.05) 1px,transparent 0,transparent 5px),repeating-linear-gradient(0deg,hsla(0,0%,77.6%,.05),hsla(0,0%,77.6%,.05) 1px,transparent 0,transparent 5px),repeating-linear-gradient(0deg,hsla(0,0%,77.6%,.06),hsla(0,0%,77.6%,.06) 1px,transparent 0,transparent 15px),repeating-linear-gradient(90deg,hsla(0,0%,77.6%,.06),hsla(0,0%,77.6%,.06) 1px,transparent 0,transparent 15px),linear-gradient(90deg,#fff,#fff)}.chat[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}.chat[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:rgba(0,0,0,.2) hsla(0,0%,100%,.1)!important}.chat[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#bbb}mat-card[_ngcontent-%COMP%]{padding:5px}"]}),e})();const _=[{path:"",component:(()=>{class e{constructor(){this.info=new o.a}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=c.Ib({type:e,selectors:[["app-chat"]],decls:8,vars:3,consts:[[2,"z-index","9","height","calc(100vh - 200px)"],["sidenav",""],["mode","side",3,"opened"],["snav",""],[2,"width","220px"],[3,"info"]],template:function(e,t){1&e&&(c.Ub(0,"mat-sidenav-container",0,1),c.Ub(2,"mat-sidenav",2,3),c.Ub(4,"div",4),c.Pb(5,"app-contacts",5),c.Tb(),c.Tb(),c.Ub(6,"mat-sidenav-content"),c.Pb(7,"app-message",5),c.Tb(),c.Tb()),2&e&&(c.Cb(2),c.mc("opened",!0),c.Cb(3),c.mc("info",t.info),c.Cb(2),c.mc("info",t.info))},directives:[r.b,r.a,F,r.c,S],styles:[""]}),e})()}];let A=(()=>{class e{}return e.\u0275mod=c.Mb({type:e}),e.\u0275inj=c.Lb({factory:function(t){return new(t||e)},imports:[[n.h.forChild(_)],n.h]}),e})();var $=s("MutI");let K=(()=>{class e{}return e.\u0275mod=c.Mb({type:e}),e.\u0275inj=c.Lb({factory:function(t){return new(t||e)},imports:[[i.c,A,r.d,$.b,U.b,T.f,p.j,p.s,g.e,w.b,C.c,M.b,x.c]]}),e})()}}]);